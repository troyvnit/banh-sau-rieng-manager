@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div>
    <div class="k-toolbar k-grid-toolbar">
        <a class="k-button" title="Thêm sản phẩm" id="addProduct"><span class="k-icon k-i-plus"></span></a>
                <a class="k-button" style="display:none" id="edit"><span class="k-icon k-i-pencil"></span></a>
                <a class="k-button" style="display:none" id="delete"><span class="k-icon k-i-close"></span></a>
    </div>
    <div id="grid">
        </div>
        <div id="window">
        </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        
        var resDataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    url: '@Url.Action("ReadDataToGrid")',
                    type: "post",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json"
                },
                parameterMap: function (options, type) {
                    if (type == "read") {
                        return JSON.stringify({
                            page: options.page,
                            itemCount: 20
                        })
                    }
                }
            },
            pageSize: 20,
            serverPaging: true,
            schema: {
                data: "Data",
                total: "ItemCount",
                model: {
                    id: "ProductID",
                    fields: {
                        Avatar: { type: "string" },
                        ProductName: { type: "string" },
                        Description: { type: "string" },
                        Unit: { type: "string" },
                        ShortcutKey: { type: "string" },
                        Price: { type: "string" },
                    }
                }
            }
        })
       $("#grid").kendoGrid({
            dataSource: resDataSource,
            groupable: true,
            columnMenu: true,
            resizable: true,
            sortable: true,
            selectable: "single",
            pageable: true,
            height: 500,
            columns: [
                         { field: "ProductID", title: "ID", hidden: true },
                         {field:"ProductName",title: "Tên sản phẩm"},
                         { field:"Price",title:"Giá"},
                         { field:"Unit",title:"Đơn vị tính"},
                         { field:"Description",title:"Mô tả"},
                         { field:"ShortcutKey",title:"Phím tắt"}
                        
                    ],
            change: function (e) {
                resId = this.select().find('td:first').html();
                $("#edit").attr("data-id", resId.toString());
                $("#edit").show();
                $("#delete").attr("data-id", resId.toString());
                $("#delete").show();
            }
        });
        //window
       var window = $("#window");
       var addProduct = $("#addProduct").bind("click", function () {
            window.kendoWindow({
                width: "163px",
                title: "Thêm Sản phẩm",
                content: "/Product/Create",
                close: onClose
            });
            window.data("kendoWindow").open();
            window.data("kendoWindow").center();
            addProduct.hide();
        });

        var onClose = function () {
            addProduct.show();
        }
         $(document).keyup(function (e) {
            if (e.keyCode == 27) { window.data("kendoWindow").close(); }
        });
        //end of window
        $("#delete").click(function () {
            if (confirm("Bạn có chắc chắn muốn xóa sản phẩm này?")) {
                    $.ajax({
                        url: '@Url.Action("Delete","Restaurant")',
                        data: { 'resID': +resId },
                        success: function () {
                            $("#grid").data("kendoGrid").dataSource.read();
                        }
                    })
                    resId = "";
                    $("#edit").hide();
                    $("#delete").hide();
                    $("#viewDetail").hide();
                }
        })
    })
</script>
